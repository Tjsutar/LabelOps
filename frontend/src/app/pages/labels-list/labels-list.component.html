<div class="p-5 max-w-7xl mx-auto">
  <app-print-labels (refresh)="loadLabels(true)"></app-print-labels>
  <!-- Actions -->
  
  <div class="flex justify-between items-center mb-5 mt-5">
    <h2 class="text-xl font-semibold text-gray-800 ml-4">Recent Labels</h2>
    <div class="flex gap-3">
      <button
        (click)="exportLabels()"
        [disabled]="loading || exporting"
        class="px-4 py-2 bg-green-600 text-white rounded shadow-sm cursor-pointer text-xs font-medium hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
      >
        {{ exporting ? "Exporting..." : "Export CSV" }}
      </button>
      <button
        (click)="loadLabels(true)"
        [disabled]="loading"
        class="px-4 py-2 bg-blue-600 text-white rounded shadow-sm cursor-pointer text-xs font-medium hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
      >
        {{ loading ? "Loading..." : "Refresh" }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-10 text-gray-600">
    <p>Loading labels...</p>
  </div>

  <!-- Error State -->
  <div
    *ngIf="error"
    class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-5"
  >
    <p>{{ error }}</p>
    <button
      (click)="loadLabels()"
      class="bg-red-600 text-white border-none px-3 py-1 rounded cursor-pointer mt-2 hover:bg-red-700"
    >
      Try Again
    </button>
  </div>

  <!-- Modernized Table -->
  <!-- Modernized Scrollable Table -->
  <div
    *ngIf="!loading && !error"
    class="bg-white rounded-xl shadow-lg overflow-hidden"
  >
    <div class="flex items-center justify-between px-4 py-2 text-xs text-gray-600 bg-gray-50 border-b">
      <!-- <div>Total: {{ totalCount || labels.length }}</div> -->
      <div>Loaded: {{ labels.length }}</div>
    </div>
    <div class="max-h-[500px] overflow-y-auto">
      <table class="min-w-full border-collapse">
        <thead
          class="sticky top-0 z-10 bg-gray-200 text-xs font-bold text-gray-600 uppercase tracking-wider"
         >
          <tr>
            <th class="px-4 py-3 text-left">ID</th>
            <th class="px-4 py-3 text-left">Product</th>
            <th class="px-4 py-3 text-left">Section</th>
            <th class="px-4 py-3 text-left">Grade</th>
            <th class="px-4 py-3 text-left">Heat No</th>
            <th class="px-4 py-3 text-left">Date</th>
            <th class="px-4 py-3 text-left">Status</th>
            <th class="px-4 py-3 text-left">Actions</th>
          </tr>
        </thead>
        <tbody class="text-xs divide-y divide-gray-200">
          <tr
            *ngFor="let label of labels"
            class="hover:bg-blue-50 transition-colors duration-75 group"
          >
            <td class="px-4 py-2 whitespace-nowrap">
              {{ label.label_id || "--" }}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {{ label.product_heading || "--" }}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {{ label.section || "--" }}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {{ label.grade || "--" }}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {{ label.heat_no || "--" }}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              {{ label.date || "--" }}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              <span [class]="'font-medium px-2 py-1 rounded text-xs ' + getStatusClass(label.status)">
                {{ label.status }}
              </span> 
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              <div class="flex gap-2">
                <button
                  (click)="previewLabel(label)"
                  class="px-3 py-1 bg-blue-600 text-white border-none rounded cursor-pointer text-xs hover:bg-blue-700"
                >
                  Preview
                </button>
                <!-- <button 
                (click)="printLabel(label.id)" 
                [disabled]="loading || !label.id"
                class="px-3 py-1 bg-green-600 text-white rounded-md text-xs font-medium shadow
                       hover:bg-green-700 transition-colors duration-75 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-green-300">
                Print
              </button> -->
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div
      *ngIf="labels.length === 0"
      class="text-center py-10 text-gray-500 text-sm animate-fade-in"
    >
      <p>No labels found.</p>
    </div>

    <!-- Load More Footer -->
    <div class="flex items-center justify-center p-3 border-t bg-gray-50" *ngIf="labels.length > 0">
      
    </div>
  </div>

  <!-- Label Preview Modal -->
  <div
    *ngIf="showLabelPreview"
    class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"
    (click)="closeLabelPreview()"
  >
    <div
      class="bg-white rounded-lg max-w-4xl max-h-screen overflow-auto relative shadow-2xl animate-fade-in"
      (click)="$event.stopPropagation()"
    >
      <div
        class="flex justify-between items-center p-5 border-b border-gray-200"
      >
        <h3 class="text-xl font-semibold text-gray-800 m-0">Label Preview</h3>
        <div class="flex gap-2">
          <!-- <button
            (click)="printSelectedLabel()"
            class="px-4 py-2 bg-green-600 text-white rounded shadow cursor-pointer text-sm font-medium hover:bg-green-700"
          >
            Print Label
          </button> -->
          <button
            (click)="closeLabelPreview()"
            class="text-2xl cursor-pointer text-gray-600 hover:text-gray-800 bg-none border-none p-0 w-8 h-8 flex items-center justify-center"
          >
            &times;
          </button>
        </div>
      </div>
      <div class="p-5 flex justify-center">
        <app-label *ngIf="selectedLabel" [label]="selectedLabel">
        </app-label>
      </div>
    </div>
  </div>
</div>
